---
title: åŸºäºOPAçš„æ¨¡æ‹Ÿè¡¥å¿å™¨è®¡ç®—
date: 2022-01-16 13:07:00
permalink: /pages/20220116130700
categories: 
  - æŠ€æœ¯
  - æŠ€æœ¯æ–‡æ¡£
tags: 
  - null
author: 
  name: Roger
  link: https://github.com/Roger0x0000
---

&#8194;&#8194;&#8194;&#8194;åŸºäºOPAçš„æ¨¡æ‹Ÿè¡¥å¿å™¨è®¡ç®—ã€‚

<!-- more -->

# åŸºäºOPAçš„æ¨¡æ‹Ÿè¡¥å¿å™¨è®¡ç®—

## â… å‹è¡¥å¿å™¨


![â… å‹è¡¥å¿å™¨](/blog/blog_image/20220116131018.png 'â… å‹è¡¥å¿å™¨')

### ä¼ é€’å‡½æ•°æ¨å¯¼

&#8194;&#8194;&#8194;&#8194;å€ŸåŠ©Pythonå¯ä»¥æ–¹ä¾¿æ¨å¯¼å‡ºè¡¥å¿å™¨çš„ä¼ é€’å‡½æ•°ï¼š

```Python
            
import sympy as sp

R1,C1,s = sp.symbols('R1 C1 s')
 
Zf =  1/(C1*s)
Zi = R1

H1 = sp.factor(Zf/Zi)
print("H1 = ",H1)  
# H1 =  1/(C1*R1*s)

```

&#8194;&#8194;&#8194;&#8194;ä¼ é€’å‡½æ•°ï¼š

$$G(s)=\frac{V_{err}(s)}{V_{out}(s)}=-\frac{Z_{f}}{Z_{i}}=-\frac{\frac{1}{s\bullet C}}{R1}=\frac{1}{s\bullet R1\bullet C1} \text { (1)} $$

$$G(s)=-\frac{\frac{1}{s}}{\omega_{p0}}$$

&#8194;&#8194;&#8194;&#8194;<font color=red>**0dBç©¿è¶Šæç‚¹ï¼š**</font>
$$\omega_{p0}=\frac{1}{R1\bullet C1}$$

### å‚æ•°è®¡ç®—

+ åŸºäºç¨³æ€å€¼å¾—åˆ°R1çš„å€¼ï¼›
+ ç¡®å®šç©¿è¶Šé¢‘ç‡$f_c$ä¸åœ¨ç©¿è¶Šé¢‘ç‡å¤„è¡¥å¿å™¨èµ‹å€¼æå‡æˆ–å‡å°‘é‡ï¼›
+ æ ¹æ®ä¸Šé¢ä¿¡æ¯è®¡ç®—0dBç©¿è¶Šæç‚¹é¢‘ç‡$f_{p0}$çš„ä½ç½®ï¼›
$$f_{p0}=\frac{0dB - (-G_{f_c})}{-20dB/dec}\bullet f_c$$
&#8194;&#8194;&#8194;&#8194;å…¶ä¸­ï¼Œ$G_{f_c}$ä¸ºåŠŸç‡çº§ä¼ é€’å‡½æ•°åœ¨ç©¿è¶Šé¢‘ç‡$f_c$å¤„çš„å¹…å€¼å¤§å°ï¼Œ$f_c$ä¸ºç©¿è¶Šé¢‘ç‡ï¼Œ$f_{p0}$ä¸º0dBç©¿è¶Šæç‚¹é¢‘ç‡ã€‚
+ è®¡ç®—C1çš„å€¼ï¼›

$$C_{1}=\frac{1}{2\bullet Ï€\bullet R1\bullet f_{p0}}$$

### æ¡ˆä¾‹

&#8194;&#8194;&#8194;&#8194;å‡è®¾æœ‰ä¸€ä¸ªå¼€å…³ç”µæºåœ¨ç©¿è¶Šé¢‘ç‡1kHzå¤„çš„å¢ç›Šä¸º$G_{f_c}=-20dB$ï¼Œè¯·ä¸ºå®ƒè®¾è®¡ä¸€ä¸ªè¡¥å¿ç”µè·¯ï¼Œç›¸ä½ä¸éœ€è¦æå‡ã€‚


&#8194;&#8194;&#8194;&#8194;å€ŸåŠ©Pythonå¯ä»¥æ–¹ä¾¿è®¡ç®—å‡ºè¡¥å¿å™¨çš„å‚æ•°ï¼š

```Python

import numpy as np
import matplotlib.pyplot as plt
import control as ctrl
import math


s = ctrl.tf('s')
R1 = 10e3     #10k
fc = 1e3     #1k
G_fc = 20

# 20dB/dec è½¬æ¢æˆåè¿›åˆ¶ æ¢ç®—
y1 = math.pow(10.0,(G_fc/20)) # 20dBè½¬æ¢æˆåè¿›åˆ¶
y2 = math.pow(10.0,((G_fc-20)/20))  #  0dBè½¬æ¢æˆåè¿›åˆ¶

x1 = fc
x2 = 10*x1

k = (y1-y2)/(x1-x2)
b = y1 - k*x1

f_p0 = (math.pow(10.0,(0/20)) - b)/k  #ğ‘“ğ‘0ä¸º0dBç©¿è¶Šæç‚¹é¢‘ç‡

print("f_p0 =", f_p0, "Hz") # f_p0 = 10000.0 Hz

C1 = 1/(2*np.pi*R1*f_p0)    # C1 = 1.5915494309189533 nF
print("C1 =", C1*math.pow(10.0,9), "nF")  
print("R1 =", R1, "Î©")  # R1 = 10000.0 Î©

Hp = -(1/(s*R1*C1))

f = np.logspace(-1, 6, 1000)
w = 2 * np.pi * f

mag,phase,omega=ctrl.bode_plot(Hp,w,dB=True,Hz=True,deg=True,Plot=True,label='Hp')

plt.legend()
plt.show()

```

![â… å‹è¡¥å¿å™¨](/blog/blog_image/20220116160551.png 'â… å‹è¡¥å¿å™¨')



## â…¡å‹è¡¥å¿å™¨

![â…¡å‹è¡¥å¿å™¨](/blog/blog_image/20220116131306.png 'â…¡å‹è¡¥å¿å™¨')

### ä¼ é€’å‡½æ•°æ¨å¯¼
å€ŸåŠ©Pythonå¯ä»¥æ–¹ä¾¿æ¨å¯¼å‡ºè¡¥å¿å™¨çš„ä¼ é€’å‡½æ•°ï¼š

```Python
import sympy as sp

#ä¸¤ç”µé˜»å¹¶è”æ€»å€¼
def parallel(a,b):
    return (a*b)/(a+b)


R1,R2,C1,C2,s = sp.symbols('R1 R2 C1 C2 s')
 
Zf = parallel((R2 + 1/(C1*s)),(1/(C2*s)))
Zi = R1

H2 = sp.factor(Zf/Zi)
print("H2 = ",H2)  
#H2 =  (C1*R2*s + 1)/(R1*s*(C1*C2*R2*s + C1 + C2))                    


```

### å‚æ•°è®¡ç®—

&#8194;&#8194;&#8194;&#8194;ä»¥ä¸Šçš„ä¼ é€’å‡½æ•°å¯åŒ–ç®€ä¸ºï¼š

$$G(s)=\frac{V_{err}(s)}{V_{out}(s)}=-\frac{Z_{f}}{Z_{i}}=-\frac{1+ s\bullet R2\bullet C1}{s\bullet R1\bullet(C1+C2)\bullet[1+s\bullet R2\bullet (\frac{C1\bullet C2}{C1+C2})]}\text { } $$

&#8194;&#8194;&#8194;&#8194; å°†åˆ†å­åˆ†æ¯åŒæ—¶é™¤ä»¥$s\bullet R2\bullet C1$å†™æˆé›¶æç‚¹æ ‡å‡†å½¢å¼å¦‚ä¸‹ï¼š

$$G(s)=-\frac{R2}{R1}\bullet\frac{C1}{C1+C2}\bullet\frac{1+\frac{1}{s\bullet R2\bullet C1}}{{1+s\bullet R2\bullet\frac{C1\bullet C2}{C1+C2}}}$$

$$=-G_0\bullet \frac{1+\frac{\omega_z}{s}}{1+\frac{s}{\omega_p}}$$

&#8194;&#8194;&#8194;&#8194;å…¶ä¸­å¯çŸ¥ï¼š



&#8194;&#8194;&#8194;&#8194;<font color=red>**é™æ€å¢ç›Šï¼š**</font>
$$G_{0}=\frac{R2}{R1}\bullet\frac{C1}{C1+C2}$$


&#8194;&#8194;&#8194;&#8194;æ™®é€šé›¶ç‚¹ï¼š$$\omega_z=\frac{1}{R2\bullet C1}$$

&#8194;&#8194;&#8194;&#8194;æ™®é€šæç‚¹ï¼š$$\omega_p=\frac{1}{R2\bullet (\frac{C1\bullet C2}{C1+C2})}$$



&#8194;&#8194;&#8194;&#8194;ä»¥ä¸Šçš„ä¼ é€’å‡½æ•°ä¹Ÿå¯åŒ–ç®€ä¸ºï¼š

$$G(s)=\frac{V_{err}(s)}{V_{out}(s)}=-\frac{Z_{f}}{Z_{i}}=-\frac{1+ s\bullet R2\bullet C1}{s\bullet R1\bullet(C1+C2)\bullet[1+s\bullet R2\bullet (\frac{C1\bullet C2}{C1+C2})]}\text { } $$

$$=-\frac{\omega_{p0}}{s}\bullet \frac{1+\frac{s}{\omega_{z1}}}{1+\frac{s}{\omega_{p1}}}$$


&#8194;&#8194;&#8194;&#8194;å…¶ä¸­ï¼š

$$ \omega_{p0} =2\bullet Ï€\bullet f_{p0} = \frac{1}{R1\bullet(C1+C2)}$$

$$ \omega_{z1} =2\bullet Ï€\bullet f_{z1} = \frac{1}{R2\bullet C1}$$

$$ \omega_{p1} =2\bullet Ï€\bullet f_{p1} = \frac{1}{R2\bullet\frac{C1\bullet C2}{C1+C2}}$$

&#8194;&#8194;&#8194;&#8194;è®¡ç®—ç”µé˜»å’Œç”µå®¹çš„å…¬å¼ï¼š

```Python

from unittest import result
from numpy import true_divide
import sympy as sp



eqfp0,eqfp1,eqfz1,fp0,fp1,fz1,R1,R2,C1,C2,pi = sp.symbols('eqfp0 eqfp1 eqfz1 fp0 fp1 fz1 R1 R2 C1 C2 pi')

# 
eqfp0 = 1/(2*pi*(R1*(C1+C2)))-fp0
eqfz1 = 1/(2*pi*(R2*C1))-fz1
eqfp1 = 1/(2*pi*(R2*(C1*C2)/(C1+C2)))-fp1

#è§£æ–¹ç¨‹ç»„å’Œè®¡ç®—R2.C1.C2
result = sp.solve([eqfp0,eqfz1,eqfp1],[R2,C1,C2],dict=True)
print(result)  
                
#[{R2: R1*fp0*fp1/(fz1*(fp1 - fz1)),
#  C1: (fp1 - fz1)/(2*R1*fp0*fp1*pi),
#  C2: fz1/(2*R1*fp0*fp1*pi)}]


```

&#8194;&#8194;&#8194;&#8194;è¿è¡Œä¸Šè¿°ä»£ç ï¼Œå¯ä»¥å¾—åˆ°ç”µé˜»å’Œç”µå®¹çš„å…¬å¼ï¼š

$$R2 = \frac{R1\bullet f_{p0}\bullet f_{p1}}{f_{z1}\bullet (f_{p1} - f_{z1})}$$

$$C1 = \frac{f_{p1}-f_{z1}}{2Ï€\bullet R1\bullet f_{p0}\bullet f_{p1}}$$

$$ C2 = \frac{f_{z1}}{2Ï€\bullet R1\bullet f_{p0}\bullet f_{p1}}$$


### æ¡ˆä¾‹

&#8194;&#8194;&#8194;&#8194;å‡è®¾éœ€è¦ä¸ºä¸€ä¸ªå¼€å…³ç”µæºè®¾è®¡è¡¥å¿ç”µè·¯ï¼Œè¦æ±‚åœ¨ç©¿è¶Šé¢‘ç‡5kHzå¤„éœ€è¦æä¾›$G_{f_c}=15dB$ï¼Œç›¸ä½æå‡50Â°ï¼Œè¯¥å¦‚ä½•è®¾è®¡è¡¥å¿ç”µè·¯ï¼Ÿ

+ è®¡ç®—åœ¨ç©¿è¶Šé¢‘ç‡å¤„æä¾›å¹…å€¼å¢ç›Š15dBçš„åè¿›åˆ¶å¢ç›Šï¼š

$$G = 10^{\frac{15}{20}}=5.6234$$
+ æ±‚å–Kå› å­

$$ K = Tan[(\frac{Boost}{2}) + 45Â°] = Tan[(\frac{50Â°}{2}) + 45Â°]=Tan(\frac{70\bullet Ï€}{180}) = 2.747477419
$$

+ æ±‚å–$f_{p1}$

$$f_{p1}=K\bullet f_{c} = 13.7373871kHz$$

+ æ±‚å–$f_{z1}$
$$f_{z1}=\frac{f_{c}}{K} = 1.819851171kHz$$

+ æŒ‰ç…§Kå› å­æ³•è®¡ç®—C1ã€C2å’ŒR2

$$C2 =\frac{1}{2*Ï€*f_c*G*K*R1} = \frac{1}{2*Ï€*5000*5.6234*2.747477419*10000} = 206pF$$

$$C1 =C2*(K^2-1) =206pF*(2.747477419*2.747477419-1) = 1.3nF $$

$$R2 =\frac{K}{2*Ï€*f_c*C1} = \frac{2.747477419}{2*Ï€*5000*1.3nF} = 64.8kÎ©$$

å€ŸåŠ©Pythonå¯ä»¥æ–¹ä¾¿è®¡ç®—å‡ºè¡¥å¿å™¨çš„å‚æ•°ï¼š

![â…¡å‹è¡¥å¿å™¨](/blog/blog_image/20220116184721.png 'â…¡å‹è¡¥å¿å™¨')


```Python

import numpy as np
import matplotlib.pyplot as plt
import control as ctrl
import math


s = ctrl.tf('s')

R1 = 10e3 #10K
C1 = 1.3*math.pow(10.0,-9)  #nF
R2 = 64.8e3 #64.8K
C2 = 206*math.pow(10.0,-12) #pF

f_p0 = 1/(2*np.pi*R1*(C1+C2))           
f_z1 = 1/(2*np.pi*R2*C1)                
f_p1 = 1/(2*np.pi*R2*((C1*C2)/(C1+C2))) 

print("f_p0 =", f_p0, "Hz") 
print("f_z1 =", f_z1, "Hz") 
print("f_p1 =", f_p1, "Hz") 

#f_p0 = 10568.057310218814 Hz
#f_z1 = 1889.3036929237342 Hz
#f_p1 = 13812.093988073513 Hz

w_p0 = 2*np.pi*f_p0
w_z1 = 2*np.pi*f_z1
w_p1 = 2*np.pi*f_p1



H2 = -(w_p0/s)*(1+s/w_z1)/(1+s/w_p1)

f = np.logspace(-1, 6, 1000)
w = 2 * np.pi * f

mag,phase,omega=ctrl.bode_plot(H2,w,dB=True,Hz=True,deg=True,Plot=True,label='H2')

plt.legend()
plt.show()


```



## â…¢å‹è¡¥å¿å™¨

![â…¢å‹è¡¥å¿å™¨](/blog/blog_image/20220116131341.png 'â…¢å‹è¡¥å¿å™¨')

### ä¼ é€’å‡½æ•°æ¨å¯¼
å€ŸåŠ©Pythonå¯ä»¥æ–¹ä¾¿æ¨å¯¼å‡ºè¡¥å¿å™¨çš„ä¼ é€’å‡½æ•°ï¼š

```Python

```
### å‚æ•°è®¡ç®—

### æ¡ˆä¾‹






## å‚è€ƒæ–‡æ¡£


[åŸºäºpython - å­¦ä¹ æ¨¡æ‹Ÿè¡¥å¿å™¨](https://www.bilibili.com/video/BV1DF411H7r5)

[å¼€å…³ç”µæºç³»åˆ—è¯¾ç¨‹](https://www.darwinlearns.com/)
